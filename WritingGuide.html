<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>


<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="robots" content="index,nofollow">

<title>RhythmboxPlugins/WritingGuide - GNOME Live!</title>
<script type="text/javascript" src="WritingGuide_files/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" 
href="WritingGuide_files/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" 
href="WritingGuide_files/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" 
href="WritingGuide_files/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" 
media="projection" href="WritingGuide_files/projection.css">

<!-- css only for MSIE browsers -->
<!--[if IE]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static164/gnome/css/msie.css">
<![endif]-->



<link rel="Start" href="http://live.gnome.org/Home">
<link rel="Alternate" title="Wiki Markup" 
href="http://live.gnome.org/RhythmboxPlugins/WritingGuide?action=raw">
<link rel="Alternate" media="print" title="Print View" 
href="http://live.gnome.org/RhythmboxPlugins/WritingGuide?action=print">
<link rel="Up" href="http://live.gnome.org/RhythmboxPlugins">
<link rel="Search" href="http://live.gnome.org/FindPage">
<link rel="Index" href="http://live.gnome.org/TitleIndex">
<link rel="Glossary" href="http://live.gnome.org/WordIndex">
<link rel="Help" href="http://live.gnome.org/HelpOnFormatting">
<style> #feedlySignPart { background-color: #333333; opacity: 0.0; color: #fff; max-width: 600px; margin: 0px; padding: 20px; text-align: center; font-size: 18px; font-weight: bold; z-index:99999; position: absolute; -moz-user-select: none; -moz-border-radius: 10px; -webkit-border-radius: 10px; } #feedlySignPart a { color: #FFFFFF; text-decoration: none; } #feedlySignPart a:hover { color: #FFFFFF; text-decoration: underline; } #feedlyHelpSignPart { font-size: 13px; background-color: #111; opacity: 0.0; color: #fff; margin: 0px; padding: 20px; z-index:99999; position: absolute; width: 500px; line-height: 17px; -moz-border-radius: 10px; -webkit-border-radius: 10px; } #feedlyHelpSignPart .title { border-bottom: 1px solid #444444; font-weight: bold; color: #999999; padding-bottom: 9px; margin-bottom: 9px; } #feedlyHelpSignPart .hint { float: right; font-size: 10px; color: #999999; } #feedlyHelpSignPart div.section { margin-top: 0px; margin-bottom: 17px; width:250px; float:left; } #feedlyHelpSignPart div.section .label { font-weight: bold; color: #999999; } #feedlyHelpSignPart div.subsection { margin-left: 18px; } #feedlyHelpSignPart .shortcut { font-weight: normal; color: #74AB00; padding-right: 6px; font-weight: bold; } #feedlyHelpSignPart .description { font-weight: normal; } #feedlyHelpSignPart .caps { text-transform:uppercase; font-size: 10px; } </style></head><body
 data-feedly-processed="yes" dir="ltr" lang="en"><div style="position: 
fixed; bottom: 25px; right: 0px; z-index: 999999; height: 100px; width: 
730px; margin-right: 32px; display: none;" id="feedlyPopupBox"><iframe 
id="feedlyPopup" border="0" style="width: 100%; height: 100%; border: 
0px none; margin: 0px;" src="WritingGuide_files/mini_003.html"></iframe></div><div
 style="position: fixed; top: 0px; left: 0px; z-index: 90000; height: 
100%; width: 100%; display: none;" id="feedlyDialogHolderBox"><iframe 
id="feedlyDialogHolder" border="0" style="width: 100%; height: 100%; 
border: 0px none; margin: 0px;" src="WritingGuide_files/mini_003.html"></iframe></div><div
 style="position: fixed; bottom: 25px; right: 0px; height: 156px; 
z-index: 999999; width: 25px; margin-right: 0px;" id="feedlyMiniBarBox"><iframe
 id="feedlyMiniBar" border="0" style="width: 25px; height: 156px; 
border: 0px none; margin: 0px; display: block;" 
src="WritingGuide_files/mini_003.html"></iframe></div>

  <div id="page">
    <ul id="general">
      <li id="siteaction-gnome_home" class="home">
        <a href="http://www.gnome.org/" title="Home">Home</a>
      </li>
      <li id="siteaction-gnome_news">
        <a href="http://news.gnome.org/" title="News">News</a>
      </li>
      <li id="siteaction-gnome_projects">
        <a href="http://www.gnome.org/projects/" title="Projects">Projects</a>
      </li>
      <li id="siteaction-gnome_art">
        <a href="http://art.gnome.org/" title="Art">Art</a>
      </li>
      <li id="siteaction-gnome_support">
        <a href="http://www.gnome.org/support/" title="Support">Support</a>
      </li>
      <li id="siteaction-gnome_development">
        <a href="http://developer.gnome.org/" title="Development">Development</a>
      </li>
      <li id="siteaction-gnome_community">
        <a href="http://www.gnome.org/community/" title="Community">Community</a>
      </li>
    </ul>
    <div id="header">
      <h1>
        live.gnome.org
      </h1>
      <div id="control">
        <div id="search">


<form id="searchform" method="get" 
action="/RhythmboxPlugins/WritingGuide">
<div>
<input name="action" value="fullsearch" type="hidden">
<input name="context" value="180" type="hidden">
<label style="display: none;" for="searchinput">Search:</label>
<input class="disabled" id="searchinput" name="value" value="Search" 
size="20" onfocus="searchFocus(this)" onblur="searchBlur(this)" 
onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search" 
type="text">
<input disabled="disabled" id="titlesearch" name="titlesearch" 
value="Titles" alt="Search Titles" type="submit">
<input disabled="disabled" id="fullsearch" name="fullsearch" 
value="Text" alt="Search Full Text" type="submit">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>


        </div>
      </div>
      

<div id="tabs">
  <ul id="portal-globalnav">
<li class="wikilink"><a href="http://live.gnome.org/Home"><span>Home</span></a></li><li
 class="wikilink"><a href="http://live.gnome.org/RecentChanges"><span>RecentChanges</span></a></li><li
 class="wikilink"><a href="http://live.gnome.org/Schedule"><span>Schedule</span></a></li><li
 class="wikilink"><a href="http://live.gnome.org/HelpContents"><span>HelpContents</span></a></li><li
 class="selected"><a 
href="http://live.gnome.org/RhythmboxPlugins/WritingGuide"><span>Writing
 Guide</span></a></li>
  </ul>
</div> <!-- end of #tabs -->


    </div> <!-- end of #header -->
  </div>
<!-- end site header -->


<div class="body" dir="ltr" lang="en">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-2"></span><p class="line867"></p><div 
class="table-of-contents"><p class="table-of-contents-heading">Contents</p><ol><li><a
 href="#head-07a97bc29ecaec10af70a24eeeea9a9c42d0c717">Introduction to 
Rhythmbox plugins</a></li><li><a 
href="#head-32d9e26e310151a91a7f2d24fd146b1b22f6f073">What makes up a 
plugin</a><ol><li><a 
href="#head-ec46257a6c7605dec0ad8b507012574ae31158cb">The Plugin 
Description File</a></li></ol></li><li><a 
href="#head-c4c2be31668c8fcc754261132313e7cd04bddff7">Overview of 
Rhythmbox internals - pieces of the puzzle</a><ol><li><a 
href="#head-5a0eb49c412691ea786c7857d1933ca791c23727">Top level</a></li><li><a
 href="#head-de12e20c9d5afed55db1db5d70275e5f168e5565">Sources</a></li><li><a
 href="#head-1714c567fc6df09f24d65b003fcc7e856a2998da">Lower-level 
database</a></li><li><a 
href="#head-b97fea1ec825e37ea158fcc907de820ef3223c96">Higher-level 
database</a></li></ol></li><li><a 
href="#head-661e2a8f9a28083faeb967afdc3feda5b36d17a8">Plugin basics - 
turn it on, turn it off</a><ol><li><a 
href="#head-dc4beb8433ce704665203b0e8140370582863095">Activation</a></li><li><a
 href="#head-1a359bcaa20bf0048d4af49ea2908bf429e705ca">Deactivation</a></li><li><a
 href="#head-061e28432c12f2d0184f3a04a8305148dfa7b814">Finding your 
files</a></li></ol></li><li><a 
href="#head-7f703459b19f07f0ae7eb0349c8228fb259e9b82">Database 
essentials</a><ol><li><a 
href="#head-4f9f5fffc58b0bcc2a73535b656bf768ce251f45">Entries</a></li><li><a
 href="#head-8b7ff971f680a9c3b5e541ee0e4fa97b75bc8665">Entry Types</a></li></ol></li><li><a
 href="#head-f8b1dca0ff4f18a12da6244e331ac8cd7e7ea0ff">Making your 
plugin do something useful</a><ol><li><a 
href="#head-022f151490b4e9ce67724a62eddcabcfdc7f7cca">Adding UI</a></li><li><a
 href="#head-107f4ab8e7fc1bf19226417bbb3ef55daf09d3db">Creating a Source</a></li><li><a
 href="#head-8c75a42bed9145aa383e67f34363edd2acb3d357">Adding support 
for new Removable Media</a></li><li><a 
href="#head-7cc2af3615038516ef1d59012df6a9d19b83ee18">Controlling 
Playback</a></li><li><a 
href="#head-5cced536c3b5ca72946e5b0c3a496c7d1f686d4b">Adding a new tab 
to the "Song Info" window</a></li><li><a 
href="#head-49fe09e8941347300be7f76fd28ec163b2e86441">Perform actions 
when a source is first clicked on</a></li></ol></li><li><a 
href="#head-c43db38ba00af0f1493d54b97c70878f211a5814">Doing things the 
right way</a><ol><li><a 
href="#head-a6becdd791a612695c0e00ecb8257cb1ab3d0e24">Using threads when
 you don't need to</a></li><li><a 
href="#head-bfc9032902eebc86a4b92000c22510260534f1f2">Using asynchronous
 IO</a></li><li><a href="#head-4359a4580532110db4a49c7c85af93574d5051f9">Streaming
 IO</a></li><li><a href="#head-5aa93657b105402333622301cf1fd0c57b133cb5">Using
 idle callbacks for repeated tasks</a></li></ol></li><li><a 
href="#head-7a185be2a26176c61db014d8eeb8c980c95fbf15">Doing Cool 
Things(tm)</a><ol><li><a 
href="#head-7cd42591b00fdab44374fd57538003a192960070">Adding elements to
 the GStreamer playback pipeline</a></li></ol></li><li><a 
href="#head-52167e5ed4a8acd0c087de2633e890dab5d871da">How do I ...</a><ol><li><a
 href="#head-7fd5985806ac73cff392fa77027e2432f24bd4da">Get the list of 
entries in a source?</a></li><li><a 
href="#head-dbb2fdf06779fa9211dd014279f1ff57690db652">Disable a bad 
plugin from outside Rhythmbox?</a></li></ol></li><li><a 
href="#head-dd038444a38370785adc408c52c53fb9edf95bd7">Things to check 
before checking into SVN</a></li></ol></div> <span class="anchor" 
id="line-3"></span><span class="anchor" id="line-4"></span><p 
class="line867">
</p><h1 id="head-07a97bc29ecaec10af70a24eeeea9a9c42d0c717">Introduction 
to Rhythmbox plugins</h1>
<span class="anchor" id="line-5"></span><p class="line874">Rhythmbox 
plugins are external pieces of code that can be loaded to provide extra 
functionality that is not found in the normal "vanilla" Rhythmbox. 
Plugins can do basically everything that Rhythmbox itself could do, and 
in fact some "core" features like Audio CD support and Internet Radio 
are actually plugins (although not displayed to users as such). <span 
class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span></p><p
 class="line874">Rhythmbox plugins can currently be written in two 
languages, C and Python; although nothing inherently stops you using 
other languages, it would require someone to invest a large amount of 
time to add support for that language.  Python plugins are generally 
easier to write and maintain, unless you are an experienced 
GObject-based C programmer, so they are recommended for new plugins. 
There are two limitation of Python plugins: 1) some of the Rhythmbox API
 hasn't been bound yet, and 2) no support for threads - but these are 
not usually an issue because we (the Rhythmbox developers) are happy to 
add the missing API if asked, and there is almost always a smarter way 
to do something that doesn't require threads. <span class="anchor" 
id="line-8"></span><span class="anchor" id="line-9"></span></p><p 
class="line874">Most code samples in this document are written in 
Python, as it is easier to read and can act as pseudo-code for C 
programmers. In addition Python plugins can be put into your per-user 
plugin directory and edited there, whereas C plugins must be built 
inside the source tree (because they need access to the headers). <span 
class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span></p><p
 class="line862">An overview of the components that form Rhythmbox's 
internals is available on the <a class="http" 
href="http://live.gnome.org/Rhythmbox/InternalDesign">Internal Design</a>
 page.  Some distributions ship the generated API documentation, but for
 those who don't have a local copy, it is available on <a class="http" 
href="http://library.gnome.org/devel/rhythmbox/unstable/">library.gnome.org</a>
 too. <span class="anchor" id="line-12"></span><span class="anchor" 
id="line-13"></span></p><p class="line862">If you have any questions, 
please feel free to ask us in either the IRC channel (#rhythmbox on 
irc.gimp.net) or the mailing list ( <a class="mailto" 
href="mailto:rhythmbox-devel@lists.gnome.org">rhythmbox-devel@lists.gnome.org</a>
 ). The IRC channel is usually better, as you can have a discussion in 
real-time, but feel free to use the mailing list if you don't get a 
response - as we may be sleeping/at work/away/etc. <span class="anchor" 
id="line-14"></span><span class="anchor" id="line-15"></span></p><p 
class="line867">
</p><h1 id="head-32d9e26e310151a91a7f2d24fd146b1b22f6f073">What makes up
 a plugin</h1>
<span class="anchor" id="line-16"></span><p class="line874">There are 
two files required for a plugin, a plugin description file (a .rb-plugin
 file) and some plugin code (a .so for C, or a .py for Python). These 
files can potentially live in three locations, two of which are found on
 a user's system and one for developers. <span class="anchor" 
id="line-17"></span><span class="anchor" id="line-18"></span></p><p 
class="line874">The first place Rhythmbox looks for plugins is in 
"$libdir/rhythmbox/plugins" (usually /usr/lib/rhythmbox/plugins), and 
this is where system-installed plugins reside. Normally only "official" 
plugins that are shipped with Rhythmbox itself are installed here, 
although other plugins can be, because it's easier to install them in 
the per-user plugin directory. <span class="anchor" id="line-19"></span><span
 class="anchor" id="line-20"></span></p><p class="line874">The second 
place where Rhythmbox looks is in the per-user plugin directory, 
$HOME/.gnome2/rhythmbox/plugins. Python plugins can simply be dropped 
into this folder, and C plugins can be installed there. <span 
class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span></p><p
 class="line874">The third location (for developers) is active if you 
passed "--enable-uninstalled-build" to configure, so that Rhythmbox 
looks in "plugins/" when running uninstalled. This is useful for C 
plugins, as they are built inside the source tree. <span class="anchor" 
id="line-23"></span><span class="anchor" id="line-24"></span></p><p 
class="line867">
</p><h2 id="head-ec46257a6c7605dec0ad8b507012574ae31158cb">The Plugin 
Description File</h2>
<span class="anchor" id="line-25"></span><p class="line874">The plugin 
description file contains the metadata shown in the "Plugins" dialog and
 the information necessary for Rhythmbox to load your plugin. A sample 
file can be found in the "plugins/sample/" and "plugins/sample-python/" 
directories of the source. The basic format is: <span class="anchor" 
id="line-26"></span><span class="anchor" id="line-27"></span></p><p 
class="line867"><span class="anchor" id="line-28"></span><span 
class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><span
 class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><span
 class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><span
 class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span></p><pre>[RB Plugin]
Module=floonitz
IAge=1
Name=Test plugin
Description=A test plugin
Authors=Your Name &lt;your email address&gt;
Copyright=Copyright © 2007 Your name
Website=http://some.website/</pre><span class="anchor" id="line-37"></span><p
 class="line874">or <span class="anchor" id="line-38"></span><span 
class="anchor" id="line-39"></span></p><p class="line867"><span 
class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><span
 class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><span
 class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><span
 class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><span
 class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span></p><pre>[RB Plugin]
Loader=python
Module=floonitz
IAge=1
Name=Python test plugin
Description=A python test plugin
Authors=Your Name &lt;your email address&gt;
Copyright=Copyright © 2007 Your name
Website=http://some.website/</pre><span class="anchor" id="line-50"></span><span
 class="anchor" id="line-51"></span><p class="line867">
</p><h3 id="head-69adec6b3a6b5ddc18daf0b0d227cb4d216feaef">Fields</h3>
<span class="anchor" id="line-52"></span><span class="anchor" 
id="line-53"></span><div><table><tbody><tr>  <td><p class="line862">Loader
 </p></td>
  <td><p class="line862">The name of the plugin-loading module to use. 
If you are writing a C plugin, leave this out. If you are writing a 
Python plugin, make loader be "python". </p></td>
</tr>
<tr>  <td><span class="anchor" id="line-54"></span><p class="line862">Module
 </p></td>
  <td><p class="line862">The name of the module to load. If you are 
writing a C plugin, Rhythmbox will look for "module.so". If you are 
writing a Python plugin, Rhythmbox will look for a directory called 
"module" with a <tt class="backtick">__init__.py</tt> file inside, or 
"module.py" (the former is better). </p></td>
</tr>
<tr>  <td><span class="anchor" id="line-55"></span><p class="line862">IAge
 </p></td>
  <td><p class="line862">Set to 1. </p></td>
</tr>
<tr>  <td><span class="anchor" id="line-56"></span><p class="line862">Name
 </p></td>
  <td><p class="line862">The plugin will be shown as "name" in the list 
in the plugins dialog. </p></td>
</tr>
<tr>  <td><span class="anchor" id="line-57"></span><p class="line862">Description
 </p></td>
  <td colspan="1" rowspan="4" style="text-align: left;"><p 
class="line862">These will all be shown in the information section of 
the plugins dialog when your plugin is selected. </p></td>
</tr>
<tr>  <td><span class="anchor" id="line-58"></span><p class="line862">Authors
 </p></td>
</tr>
<tr>  <td><span class="anchor" id="line-59"></span><p class="line862">Copyright
 </p></td>
</tr>
<tr>  <td><span class="anchor" id="line-60"></span><p class="line862">Website
 </p></td>
</tr>
</tbody></table></div><span class="anchor" id="line-61"></span><span 
class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><p
 class="line862">For Python plugins, best practice is to have a <tt 
class="backtick">__init__.py</tt> file containing your code, the 
.rb-plugin file and and other files in a directory called 
"yourpluginname" in the per-user plugin directory. <span class="anchor" 
id="line-64"></span><span class="anchor" id="line-65"></span></p><p 
class="line874">For C plugins, you will need to create a directory named
 after your plugin in the "plugins/" folder of the source tree, and then
 edit configure.ac and plugins/Makefile.am to add your plugin. Copying 
the infrastructure from one of the existing C plugins is probably a good
 idea. <span class="anchor" id="line-66"></span><span class="anchor" 
id="line-67"></span></p><p class="line867">
</p><h1 id="head-c4c2be31668c8fcc754261132313e7cd04bddff7">Overview of 
Rhythmbox internals - pieces of the puzzle</h1>
<span class="anchor" id="line-68"></span><p class="line874">Rhythmbox 
contains a large number of pieces, which work together to provide the 
whole program. When first encountering Rhythmbox's internals, it is very
 easy to try to understand the details of everything all at once, which 
can become confusing. It is a much better idea to think about what you 
want to do, and learn about the pieces need to do that, before spreading
 your wings into the rest of the application. <span class="anchor" 
id="line-69"></span><span class="anchor" id="line-70"></span></p><p 
class="line874">To further that gradual introduction, an overview of 
what the pieces are (so you have a general understanding of how things 
fit together) is provided below, followed by a more detailed explanation
 of the components. You should not need to follow the detailed 
explanations to work on a simple plugin, unless the component is 
relevant to what you are doing. The class names given below are the 
python variants, but the C versions are the same with the period 
removed. <span class="anchor" id="line-71"></span><span class="anchor" 
id="line-72"></span></p><p class="line867">
</p><h2 id="head-5a0eb49c412691ea786c7857d1933ca791c23727">Top level</h2>
<span class="anchor" id="line-73"></span><p class="line874">The window 
you see when you use Rhythmbox is called the "shell" (the single 
instance of rb.Shell) and it is the glue that binds the application 
together. Plugins are given a reference to the shell when they start, as
 you can get access to basically every other useful object by starting 
with the shell. There are a few other single-instance objects that are 
accessible from the shell, namely the "removable media manager" and the 
"playlist manager". <span class="anchor" id="line-74"></span><span 
class="anchor" id="line-75"></span></p><p class="line867">
</p><h2 id="head-de12e20c9d5afed55db1db5d70275e5f168e5565">Sources</h2>
<span class="anchor" id="line-76"></span><p class="line874">The source 
list in the side pane contains a list of all the instances of rb.Source,
 each of the sources controls the sections to the right which usually 
contains the track list, browsers, et al. Very few sources derive 
directly from rb.Source, as there are a number of classes implementing 
common useful functionality. <span class="anchor" id="line-77"></span><span
 class="anchor" id="line-78"></span></p><p class="line862">The "track 
list" is an instance of the rb.<a class="nonexistent" 
href="http://live.gnome.org/EntryView">EntryView</a> class which uses a 
rhythmdb.<a class="nonexistent" href="http://live.gnome.org/QueryModel">QueryModel</a>
 as a data store to hold the list of tracks.  To get the entry view for a
 given source, call source.get_entry_view(). A "browser", such as the 
artist ones, is an instance of rb.<a class="nonexistent" 
href="http://live.gnome.org/PropertyView">PropertyView</a> which 
similarly uses rhythmdb.<a class="nonexistent" 
href="http://live.gnome.org/PropertyModel">PropertyModel</a> as it's 
data store. To get a list of the property views for a given source, call
 source.get_property_views(). More on those data structures later. <span
 class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span></p><p
 class="line867">
</p><h2 id="head-1714c567fc6df09f24d65b003fcc7e856a2998da">Lower-level 
database</h2>
<span class="anchor" id="line-81"></span><p class="line862">Almost all 
of the data in Rhythmbox is stored in a database called "RhythmDB", 
which can have assorted back-end implementations, although currently 
everyone uses RhythmDBTree. The most important data structure in the 
database is the <em>entry</em> (rhythmdb.Entry) which represents a 
single track, podcast episode, podcast feed, radio station or similar 
item. Each entry has a set of properties with associated values, such as
 "title", "artist", "play count" and so one; one of these properties is 
special, the "location" which must be unique among all the entries in 
the database. <span class="anchor" id="line-82"></span><span 
class="anchor" id="line-83"></span></p><p class="line867">
</p><h2 id="head-b97fea1ec825e37ea158fcc907de820ef3223c96">Higher-level 
database</h2>
<span class="anchor" id="line-84"></span><p class="line862">A very 
important higher-level structure is the "query model" mentioned above, 
which can be thought of as a list of tracks. There are two ways of 
creating and using a query model, one is to fill in the entries 
manually, as it done for "static" (non-automatic) playlists. The other 
is to give the model a <em>query</em> to process, such as "all entries 
of type SONG, with the title containing an 'a', sorted by artist", and 
the query model will take care of ensuring the list of entries is up to 
date and sorted correctly. <span class="anchor" id="line-85"></span><span
 class="anchor" id="line-86"></span></p><p class="line874">The property 
model is somewhat similar, being given a query model and a property 
type, it will create and keep up to date a sorted list of all values of 
that property. For example being given a query model containing all the 
SONG tracks in the database and the property "artist", it will produce a
 list of all artists in the music library, which is what is used for the
 "artist browser". <span class="anchor" id="line-87"></span><span 
class="anchor" id="line-88"></span></p><p class="line867">
</p><h1 id="head-661e2a8f9a28083faeb967afdc3feda5b36d17a8">Plugin basics
 - turn it on, turn it off</h1>
<span class="anchor" id="line-89"></span><p class="line874">Plugins only
 have two method that they need to implement, the activation function 
and the deactivation function. The activation function is called when 
the user enabled your plugin from the plugins dialog, and when Rhythmbox
 starts if it was activated last time Rhythmbox ran. Similarly the 
deactivation function runs when the user disables the plugin, and when 
Rhythmbox is exiting if the plugin is active. <span class="anchor" 
id="line-90"></span><span class="anchor" id="line-91"></span></p><p 
class="line874">All real work, such as initialization or shutting things
 down, should be done in these two function, not in a constructor or 
finalizer. This is because the plugin object may still exist even though
 it has been deactivated, may be re-activated after being deactivated, 
and can potentially cause reference cycles if certain things aren't 
released in the deactivation function. <span class="anchor" id="line-92"></span><span
 class="anchor" id="line-93"></span></p><p class="line867">
</p><h2 id="head-dc4beb8433ce704665203b0e8140370582863095">Activation</h2>
<span class="anchor" id="line-94"></span><p class="line874">The 
activation function is passed a reference to the shell (an object of 
class RBShell), through which plugins access the rest of the 
application. This function usually performs such tasks as adding User 
Interface (UI) items, connecting signal handlers to watch for events, 
and the like. <span class="anchor" id="line-95"></span><span 
class="anchor" id="line-96"></span></p><p class="line874">The most basic
 Python plugin with an activation function would be: <span 
class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span></p><p
 class="line867"><span class="anchor" id="line-99"></span><span 
class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><span
 class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><span
 class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span></p><pre>import rb
class FloonitzPlugin (rb.Plugin):
    def __init__(self):
        rb.Plugin.__init__(self)
    def activate(self, shell):
        print "Hello World"</pre><span class="anchor" id="line-106"></span><p
 class="line874">Note that if you try this, you won't actually see 
"Hello World" printed to standard output. Why? because print statements 
in python are re-directed to Rhythmbox's "debug logging" system. <span 
class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span></p><p
 class="line874">To see the output, you have two options: passing "-d" 
to rhythmbox from a terminal, or passing "-D filter". If you do the 
former, you will get all of Rhythmbox debug output printed - which 
almost certainly isn't what you want, as there is a lot of it. The 
second option filters the debug output to those lines that are emitting 
from a file whose pathname or function/method whose name contains 
"filter". If you plugin is called "floonitz", try "rhythmbox -D 
flootniz". <span class="anchor" id="line-109"></span><span 
class="anchor" id="line-110"></span></p><p class="line874">The 
equavalent "simple" plugin in C is a lot longer: <span class="anchor" 
id="line-111"></span><span class="anchor" id="line-112"></span></p><p 
class="line867"><span class="anchor" id="line-113"></span><span 
class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span
 class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><span
 class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><span
 class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><span
 class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><span
 class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><span
 class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><span
 class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><span
 class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span
 class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span
 class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span
 class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span
 class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span
 class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><span
 class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><span
 class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><span
 class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><span
 class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><span
 class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><span
 class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><span
 class="anchor" id="line-154"></span></p><pre>#include "rb-plugin.h"
#include "rb-debug.h"
#include "rb-shell.h"
#define RB_TYPE_FLOONITZ_PLUGIN (rb_floonitz_plugin_get_type ())
#define RB_FLOONITZ_PLUGIN(o) (G_TYPE_CHECK_INSTANCE_CAST ((o), RB_TYPE_FLOONITZ_PLUGIN, RBFloonitzPlugin))
#define RB_FLOONITZ_PLUGIN_CLASS(k) (G_TYPE_CHECK_CLASS_CAST((k), RB_TYPE_FLOONITZ_PLUGIN, RBFloonitzPluginClass))
#define RB_IS_FLOONITZ_PLUGIN(o) (G_TYPE_CHECK_INSTANCE_TYPE ((o), RB_TYPE_FLOONITZ_PLUGIN))
#define RB_IS_FLOONITZ_PLUGIN_CLASS(k) (G_TYPE_CHECK_CLASS_TYPE ((k), RB_TYPE_FLOONITZ_PLUGIN))
#define RB_FLOONITZ_PLUGIN_GET_CLASS(o) (G_TYPE_INSTANCE_GET_CLASS ((o), RB_TYPE_FLOONITZ_PLUGIN, RBFloonitzPluginClass))
typedef struct {
    RBPlugin parent;
    /* insert plugin data here */
} RBFloonitzPlugin;
typedef struct {
    RBPluginClass parent_class;
} RBFloonitzPluginClass;
G_MODULE_EXPORT GType register_rb_plugin (GTypeModule *module);
GType rb_floonitz_plugin_get_type (void) G_GNUC_CONST;
static void rb_floonitz_plugin_init (RBFloonitzPlugin *plugin);
static void rb_floonitz_plugin_finalize (GObject *object);
static void impl_activate (RBPlugin *plugin, RBShell *shell);
static void impl_deactivate (RBPlugin *plugin, RBShell *shell);
RB_PLUGIN_REGISTER(RBFloonitzPlugin, rb_floonitz_plugin)
static void rb_floonitz_plugin_class_init (RBFloonitzPluginClass *klass)
{
    GObjectClass *object_class = G_OBJECT_CLASS (klass);
    RBPluginClass *plugin_class = RB_PLUGIN_CLASS (klass);
    object_class-&gt;finalize = rb_floonitz_plugin_finalize;
    plugin_class-&gt;activate = impl_activate;
}
static void rb_floonitz_plugin_init (RBFloonitzPlugin *plugin)
{
}
static void rb_floonitz_plugin_finalize (GObject *object)
{
    G_OBJECT_CLASS (rb_floonitz_plugin_parent_class)-&gt;finalize (object);
}
static void impl_activate (RBPlugin *plugin, RBShell *shell)
{
    rb_debug ("Hello World");
}</pre><span class="anchor" id="line-155"></span><p class="line874">See 
why we said python plugins were simpler to write? <span class="anchor" 
id="line-156"></span><span class="anchor" id="line-157"></span></p><p 
class="line874">Most of the above code should be obvious for anyone who 
has done some GObject C programming, with the exception of the 
RB_PLUGIN_REGISTER line which replaces G_DEFINE_TYPE, and using rb_debug
 instead of g_printf. <span class="anchor" id="line-158"></span><span 
class="anchor" id="line-159"></span></p><p class="line867">
</p><h2 id="head-1a359bcaa20bf0048d4af49ea2908bf429e705ca">Deactivation</h2>
<span class="anchor" id="line-160"></span><p class="line874">Now that 
you've gotten your plugin activated, wouldn't you like to know how to 
turn it off? <span class="anchor" id="line-161"></span><span 
class="anchor" id="line-162"></span></p><p class="line874">The 
deactivation function is fairly simple, just undo everything what you 
did in your activation function, or while running. If you added UI, 
remove it; if you connected to some signals, disconnect them; if you 
created any objects destroy them. Most importantly, if you stored a 
reference to the shell object anywhere (or use it with a signal) the 
reference MUST BE released. If you have a reference to the shell object 
past the time your plugin's deactivation signal runs, it can make 
Rhythmbox not exit correctly. This is even more important with Python 
plugins, as it will cause a cross-runtime reference cycle. <span 
class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span></p><p
 class="line874">A simple python plugin with deactivation function <span
 class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span></p><p
 class="line867"><span class="anchor" id="line-167"></span><span 
class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><span
 class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><span
 class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><span
 class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><span
 class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><span
 class="anchor" id="line-178"></span></p><pre>import rb
class FloonitzPlugin (rb.Plugin):
    def __init__(self):
        rb.Plugin.__init__(self)
    def activate(self, shell):
        self.shell = shell
        self.string = "Hello World"
        print self.string
    def deactivate(self, shell):
        del self.shell
        del self.string</pre><span class="anchor" id="line-179"></span><p
 class="line874">The C version is left as an exercise to the reader - 
the deactivation function is identical to the activation function, but 
with the name "deactivate". <span class="anchor" id="line-180"></span><span
 class="anchor" id="line-181"></span></p><p class="line867">
</p><h2 id="head-061e28432c12f2d0184f3a04a8305148dfa7b814">Finding your 
files</h2>
<span class="anchor" id="line-182"></span><p class="line874">Almost all 
non-trivial plugins have some kind of data files they use, whether UI 
definitions, icons, or something else - and your plugin will need some 
way of finding out where they are. <span class="anchor" id="line-183"></span><span
 class="anchor" id="line-184"></span></p><p class="line874">One method 
the parent RBPlugin (rb.Plugin) class has is called "find_file" which, 
oddly enough, find a file for the plugin. You give it a short file name,
 like "myfile.txt", it will look in various places to locate it for you,
 and return the path to the file. <span class="anchor" id="line-185"></span><span
 class="anchor" id="line-186"></span></p><p class="line874">In python, 
'self.find_file("myfile.txt")' will work, and in C 
'rb_plugin_find_file(plugin, "myfile.txt");' will return a newly 
allocated char* containing the path. <span class="anchor" id="line-187"></span><span
 class="anchor" id="line-188"></span></p><p class="line867">
</p><h1 id="head-7f703459b19f07f0ae7eb0349c8228fb259e9b82">Database 
essentials</h1>
<span class="anchor" id="line-189"></span><p class="line867">
</p><h2 id="head-4f9f5fffc58b0bcc2a73535b656bf768ce251f45">Entries</h2>
<span class="anchor" id="line-190"></span><p class="line874">Database 
entries have a number of properties, a few of which might not be obvious
 at first glance <span class="anchor" id="line-191"></span><span 
class="anchor" id="line-192"></span></p><ul><li><p class="line862">LOCATION:
 this is the unique identier for an entry. It doesn't have to actually 
exist (e.g. <a class="file" href="file:///">file://</a> URIs for files 
or <a class="http" href="http:///">http://</a> URIs for internet radio),
 but this will be used as the URI to play from unless you override the 
entry-type's get_playback_uri method. <span class="anchor" id="line-193"></span></p></li><li><p
 class="line862">DATE: this usually represents the recording date of a 
track, or the year that an album was released, and is stored as a Julian
 Date. If you just have the year, convert it with something like <tt>&nbsp;julianday&nbsp;=&nbsp;datetime.date(year,&nbsp;1,&nbsp;1).toordinal()&nbsp;</tt>
 <span class="anchor" id="line-194"></span></p></li></ul><p 
class="line867">
</p><h2 id="head-8b7ff971f680a9c3b5e541ee0e4fa97b75bc8665">Entry Types</h2>
<span class="anchor" id="line-195"></span><p class="line862">An entry 
type encapsulates information and behaviour common to a class of 
entries, and is used for things like determining what entries are shown 
in a rb.<a class="nonexistent" 
href="http://live.gnome.org/BrowserSource">BrowserSource</a>. Entry 
types have the following settable properties: <span class="anchor" 
id="line-196"></span><span class="anchor" id="line-197"></span></p><ul><li>name:
 this is used for entry types that are saved on disk, and for debugging 
purposes. It must be set to a non-NULL value <span class="anchor" 
id="line-198"></span></li><li>entry_type_data_size: this is the amount 
of extra space that is allocated to each entry, to store extra per-entry
 data. Currently this isn't usable from Python <span class="anchor" 
id="line-199"></span></li><li>save_to_disk: a flag which indicates 
whether the entries should be saved into the on-disk db or not. If set 
to true entries will persist across sessions; and should be set to false
 to things that are generated dynamically, such as track on removable 
media. <span class="anchor" id="line-200"></span></li><li>category: this
 is used to indicate what behaviour to use for some things, and can be 
set to rhythmdb.ENTYRY_NORMAL (most things), rhythmdb.ENTYRY_STREAM 
(endless streams like radio and last.fm), rhythmdb.ENTRY_CONTAINER 
(podcast feeds) or rhythmdb.ENTRY_VIRTUAL (import errors). You should 
use rhythmdb.ENTYRY_NORMAL or rhythmdb.ENTYRY_STREAM unless you know 
otherwise, the difference being that streams aren't sent to last.fm. <span
 class="anchor" id="line-201"></span></li></ul><p class="line874">Entry 
types also have a few methods: <span class="anchor" id="line-202"></span><span
 class="anchor" id="line-203"></span></p><ul><li>post_entry_create: run 
after an entry is created, which is useful to set up things stored in 
the extra data area (of size entry_type_data_size), or add to mapping 
tabled. <span class="anchor" id="line-204"></span></li><li>pre_entry_destroy:
 run before an entry is destroyed, usually used to do the reverse of 
post_entry_create. <span class="anchor" id="line-205"></span></li><li>get_playback_uri:
 run when the entry is about to be played, and should return the URI to 
play, or NULL to indicate that it is unplayable. If there is no method 
set, the default is to use the LOCATION property for the playback URI. <span
 class="anchor" id="line-206"></span></li><li>can_sync_metadata: run to 
determine whether the entries metadata can be changed. If this returns 
false it cannot be edited, and if it returns true sync_metadata will 
probably be called later. <span class="anchor" id="line-207"></span></li><li>sync_metadata:
 run when the metadata of an entry has changed. For file-backed entries 
this may write the changes to disk, but if not set it will default to do
 nothing and just change the RB database. <span class="anchor" 
id="line-208"></span></li></ul><p class="line867">
</p><h1 id="head-f8b1dca0ff4f18a12da6244e331ac8cd7e7ea0ff">Making your 
plugin do something useful</h1>
<span class="anchor" id="line-209"></span><p class="line867">
</p><h2 id="head-022f151490b4e9ce67724a62eddcabcfdc7f7cca">Adding UI</h2>
<span class="anchor" id="line-210"></span><p class="line862">There are 
several methods of adding and removing widgets to the various parts of 
the Rhythmbox UI. We will explore the three most useful methods for use 
in a plugin. The first method uses a GTK tool called <a class="http" 
href="http://www.pygtk.org/docs/pygtk/class-gtkuimanager.html">UIManager</a>.
 This method is used to modify the menus and tool-bars. The second 
method is using shell.add_widget(). This method is used to add new 
widgets to various different areas of the main Rhythmbox UI. The other 
method is to add a new source page which is covered in the next section.
 <span class="anchor" id="line-211"></span><span class="anchor" 
id="line-212"></span></p><p class="line867">
</p><h3 id="head-8368c250e75693b2904e414d0ffda8265149d7b0">Adding to 
menus and toolbars (UIManager)</h3>
<span class="anchor" id="line-213"></span><p class="line874">UIManager 
uses an XML document to map a set of gtk.Actions to a location in a 
toolbar or menu. This file is called rhythmbox-ui.xml and resides inside
 the installed source tree ('data/ui/rhythmbox-ui.xml') or in your 
installed directory (e.g. /usr/share/rhythmbox/rhythmbox-ui.xml).The XML
 file is written in terms of the Action names and its structure 
determines a widget and location to bind to the corresponding action. 
The file which defines all of the Rhythmbox UI elements is 
/doc/ui/rhythmbox-ui.xml. You can conceptually think of each item in the
 UI as having a unique path which defines where it is displayed.  <span 
class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span></p><p
 class="line874">As an example, suppose you wanted to add a new item to 
the Playlist submenu of the Music menu. The "path" to that location in 
the UI is /ui/MenuBar/MusicMenu/PlaylistMenu/NewItem <span 
class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span></p><ul><li
 style="list-style-type: none;">Thus to add a new menu item in that 
location, you have to build an XML document who's structure matches that
 of the "path". The file which corresponds to the previous path is shown
 in below:  <span class="anchor" id="line-218"></span></li></ul><p 
class="line867"><span class="anchor" id="line-219"></span><span 
class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><span
 class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><span
 class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><span
 class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><span
 class="anchor" id="line-228"></span></p><pre>&lt;ui&gt; 
  &lt;menubar name="MenuBar"&gt; 
    &lt;menu name="MusicMenu" action="Music"&gt; 
        &lt;menu name="PlaylistMenu" action="Playlist"&gt;
         &lt;menuitem name="NewItem" action="NewAction"/&gt;
        &lt;/menu&gt;
    &lt;/menu&gt;
  &lt;/menubar&gt;
&lt;/ui&gt;</pre><span class="anchor" id="line-229"></span><span 
class="anchor" id="line-230"></span><p class="line874">As mentioned 
earlier, the XML file describes the positioning of items but it also 
specifies an Action which determines the item's behavior. The Action 
specified can either be defined by the programmer or connected to one of
 the existing Actions which are defined in various locations throughout 
the Rhythmbox core code. Some useful core Actions are shown in below 
along with the files they are located in.  <span class="anchor" 
id="line-231"></span><span class="anchor" id="line-232"></span></p><div><table><tbody><tr>
  <td><p class="line862"> File </p></td>
  <td><p class="line862"> Action </p></td>
  <td><p class="line862"> Description </p></td>
</tr>
<tr>  <td><span class="anchor" id="line-233"></span><p class="line862"> 
/shell/rb-shell.c </p></td>
  <td><p class="line862"> <a class="nonexistent" 
href="http://live.gnome.org/MusicQuit">MusicQuit</a> </p></td>
  <td><p class="line862"> Quit the music player </p></td>
</tr>
<tr>  <td><span class="anchor" id="line-234"></span><p class="line862"> </p></td>
  <td><p class="line862"> <a class="nonexistent" 
href="http://live.gnome.org/ViewJumpToPlaying">ViewJumpToPlaying</a> </p></td>
  <td><p class="line862"> Scroll the view to the currently playing song </p></td>
</tr>
<tr>  <td><span class="anchor" id="line-235"></span><p class="line862"> 
/shell/rb-shell-player.c </p></td>
  <td><p class="line862"> <a class="nonexistent" 
href="http://live.gnome.org/ControlPrevious">ControlPrevious</a> </p></td>
  <td><p class="line862"> Start playing the previous song </p></td>
</tr>
<tr>  <td><span class="anchor" id="line-236"></span><p class="line862"> 
 </p></td>
  <td><p class="line862"> <a class="nonexistent" 
href="http://live.gnome.org/ControlNext">ControlNext</a> </p></td>
  <td><p class="line862"> Start playing the next song </p></td>
</tr>
<tr>  <td><span class="anchor" id="line-237"></span><p class="line862"> 
 </p></td>
  <td><p class="line862"> <a class="nonexistent" 
href="http://live.gnome.org/ControlPlay">ControlPlay</a> </p></td>
  <td><p class="line862"> Start playback </p></td>
</tr>
<tr>  <td><span class="anchor" id="line-238"></span><p class="line862"> 
 </p></td>
  <td><p class="line862"> <a class="nonexistent" 
href="http://live.gnome.org/ControlShuffle">ControlShuffle</a> </p></td>
  <td><p class="line862"> Play songs in a random order </p></td>
</tr>
<tr>  <td><span class="anchor" id="line-239"></span><p class="line862"> 
 </p></td>
  <td><p class="line862"> <a class="nonexistent" 
href="http://live.gnome.org/ControlRepeat">ControlRepeat</a> </p></td>
  <td><p class="line862"> Play first song again after all songs are 
played </p></td>
</tr>
<tr>  <td><span class="anchor" id="line-240"></span><p class="line862"> 
/shell/rb-shell-playlist.c </p></td>
  <td><p class="line862"> <a class="nonexistent" 
href="http://live.gnome.org/MusicPlaylistNewPlaylist">MusicPlaylistNewPlaylist</a>
 </p></td>
  <td><p class="line862"> Create a new playlist </p></td>
</tr>
<tr>  <td><span class="anchor" id="line-241"></span><p class="line862"> 
 </p></td>
  <td><p class="line862"> <a class="nonexistent" 
href="http://live.gnome.org/MusicPlaylistDeletePlaylist">MusicPlaylistDeletePlaylist</a>
 </p></td>
  <td><p class="line862"> Delete playlist </p></td>
</tr>
<tr>  <td><span class="anchor" id="line-242"></span><p class="line862"> 
 </p></td>
  <td><p class="line862"> <a class="nonexistent" 
href="http://live.gnome.org/QueuePlaylist">QueuePlaylist</a> </p></td>
  <td><p class="line862"> Add all tracks in this playlist to the queue </p></td>
</tr>
</tbody></table></div><span class="anchor" id="line-243"></span><span 
class="anchor" id="line-244"></span><p class="line874">If you do not 
want to use one of the predefined Action, you will have to define your 
own. The code below shows the procedure for creating and adding a new 
Action to the UIManager. The action shown corresponds to the XML layout 
defined in above. <span class="anchor" id="line-245"></span><span 
class="anchor" id="line-246"></span></p><p class="line867"><span 
class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><span
 class="anchor" id="line-249"></span><span class="anchor" id="line-250"></span><span
 class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span><span
 class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><span
 class="anchor" id="line-255"></span></p><pre>action = gtk.Action ('NewAction', 
                     _('New _Action'), 
                     _('This is a new Action!'),
                     "")
action.connect ('activate', self.new_action, shell)
action_group = gtk.ActionGroup ('NewActionGroup')
action_group.add_action (action)
shell.get_ui_manager().insert_action_group (action_group)</pre><span 
class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span><p
 class="line862">Once your Actions are set up, you have to merge 
corresponding XML layout file with the existing UI layout. Suppose the 
string new_menu_item held the contents of the string defining <a 
class="nonexistent" href="http://live.gnome.org/NewAction">NewAction</a>
 shown above. Then the following code shows how to merge a new UI 
listing into the current Rhythmbox UI. This first retrieves the main 
Rhythmbox UIManager, and then merges the new elements described in the 
string new_menu_item into their proper locations.  <span class="anchor" 
id="line-258"></span><span class="anchor" id="line-259"></span><span 
class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span></p><pre>ui_manager = shell.get_ui_manager()
ui_manager.add_ui_from_string (new_menu_item)</pre><span class="anchor" 
id="line-262"></span><span class="anchor" id="line-263"></span><p 
class="line867">
</p><h3 id="head-7910b68a54d9139c8e6f3044445b80f2bab2ac93">Adding UI 
somewhere other than toolbars and menus</h3>
<span class="anchor" id="line-264"></span><span class="anchor" 
id="line-265"></span><p class="line874">The add_widget() method is 
useful when you want to add a new widget somewhere other than a menu or 
toolbar. This method is also much easier than using UIManager, but can 
be somewhat inflexible. This is because there are limited areas where 
widgets can be added. Although the placement options are limited, the 
options of what type of widget you add is not. You can use this method 
to add anything that subclasses gtk.Widget. The method signature is 
add_widget (widget, area, expand=False, fill=True) <span class="anchor" 
id="line-266"></span><span class="anchor" id="line-267"></span></p><p 
class="line874">These four areas are made available to plugins through 
the self.rb object:  <span class="anchor" id="line-268"></span></p><ul><li>SHELL_UI_LOCATION_MAIN_BOTTOM
 <span class="anchor" id="line-269"></span></li><li>SHELL_UI_LOCATION_MAIN_TOP
 <span class="anchor" id="line-270"></span></li><li>SHELL_UI_LOCATION_RIGHT_SIDEBAR
 (since v0.12.3) <span class="anchor" id="line-271"></span></li><li>SHELL_UI_LOCATION_SIDEBAR
 <span class="anchor" id="line-272"></span><span class="anchor" 
id="line-273"></span></li></ul><p class="line867">
</p><h2 id="head-107f4ab8e7fc1bf19226417bbb3ef55daf09d3db">Creating a 
Source</h2>
<span class="anchor" id="line-274"></span><p class="line874">Creating a 
new source is fairly simple with Python, but before doing so you need to
 determine what kind of source it is. Source fall into two main groups: 
those that contain all the entries of a particular type (e.g. the Radio 
source showing all stations, and the Magnatune source showing songs from
 the Magnatune catalogue), and those that contain particular entries 
(e.g. the play queue or a static playlist). <span class="anchor" 
id="line-275"></span><span class="anchor" id="line-276"></span></p><p 
class="line862">For the former, Rhythmbox has a base class, called <a 
class="nonexistent" href="http://live.gnome.org/BrowserSource">BrowserSource</a>,
 which takes care of much of the work and also provides things like the 
album/artist browsers for free. To use it, do something like the 
following <span class="anchor" id="line-277"></span><span class="anchor"
 id="line-278"></span></p><p class="line867"><span class="anchor" 
id="line-279"></span><span class="anchor" id="line-280"></span><span 
class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span><span
 class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span><span
 class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><span
 class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span></p><pre>db = shell.props.db
entry_type = db.entry_register_type("MyEntryType")
mysource = gobject.new (MySource, shell=shell, name=_("My Source"), entry_type=entry_type)
shell.append_source(mysource, None)
shell.register_entry_type_for_source(mysource, entry_type)
class MySource(rb.BrowserSource):
    def __init__(self):
        rb.BrowserSource.__init__(self)
gobject.type_register(MySource)</pre><span class="anchor" id="line-289"></span><p
 class="line862">which creates a new entry type for tracks, and creates a
 source to display them, and asks the shell to add it to the source list
 (the None parameter to append_source() says that it is a top-level 
source, with no "parent" source). Strictly, you don't need to create a 
new class in the above example and could used <a class="nonexistent" 
href="http://live.gnome.org/BrowserSource">BrowserSource</a> directly, 
but creating a new class would be required as soon as you want to do 
anything "interesting" with it. <span class="anchor" id="line-290"></span><span
 class="anchor" id="line-291"></span></p><p class="line867">
</p><h4 id="head-61210b6afd7a5a72739a806863c5e01106878d16">Adding an 
icon to your source</h4>
<span class="anchor" id="line-292"></span><p class="line867"><span 
class="anchor" id="line-293"></span><span class="anchor" id="line-294"></span><span
 class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span><span
 class="anchor" id="line-297"></span><span class="anchor" id="line-298"></span></p><pre># The following code sets the correct size for your source icon,
# finds it by its filename and adds it to a pixbuf.
width, height = gtk.icon_size_lookup(gtk.ICON_SIZE_LARGE_TOOLBAR)
icon = gtk.gdk.pixbuf_new_from_file_at_size(self.find_file("myicon.png"), width, height)
# The following code sets the sources "icon" property to the image stored in the pixbuf created above.
self.mysource.set_property( "icon",  icon) </pre><span class="anchor" 
id="line-299"></span><p class="line867">
</p><h2 id="head-8c75a42bed9145aa383e67f34363edd2acb3d357">Adding 
support for new Removable Media</h2>
<span class="anchor" id="line-300"></span><p class="line874">TODO <span 
class="anchor" id="line-301"></span><span class="anchor" id="line-302"></span></p><p
 class="line867">
</p><h2 id="head-7cc2af3615038516ef1d59012df6a9d19b83ee18">Controlling 
Playback</h2>
<span class="anchor" id="line-303"></span><p class="line874">This is 
very Simple.  Each of these examples will return a True if there are no 
problems. Here are some examples in Python: Pauses Playback.  To restart
 use "play()" <span class="anchor" id="line-304"></span><span 
class="anchor" id="line-305"></span></p><p class="line867"><span 
class="anchor" id="line-306"></span></p><pre>shell.props.shell_player.pause()</pre><span
 class="anchor" id="line-307"></span><p class="line874">Speaks for 
itself.  Plays the current song. <span class="anchor" id="line-308"></span><span
 class="anchor" id="line-309"></span></p><p class="line867"><span 
class="anchor" id="line-310"></span></p><pre>shell.props.shell_player.play()</pre><span
 class="anchor" id="line-311"></span><p class="line874">Stops Playback. 
 Restarting using "play()" starts from beginning. <span class="anchor" 
id="line-312"></span><span class="anchor" id="line-313"></span></p><p 
class="line867"><span class="anchor" id="line-314"></span></p><pre>shell.props.shell_player.stop()</pre><span
 class="anchor" id="line-315"></span><p class="line874">This Toggles 
Playback.  If its playing it will be paused, and if its paused it will 
play. <span class="anchor" id="line-316"></span><span class="anchor" 
id="line-317"></span></p><p class="line867"><span class="anchor" 
id="line-318"></span></p><pre>shell.props.shell_player.playpause()</pre><span
 class="anchor" id="line-319"></span><p class="line874">To go to 
previous/next song, use these: <span class="anchor" id="line-320"></span><span
 class="anchor" id="line-321"></span></p><p class="line867"><span 
class="anchor" id="line-322"></span><span class="anchor" id="line-323"></span></p><pre>shell.props.shell_player.do_previous()
shell.props.shell_player.do_next() </pre><span class="anchor" 
id="line-324"></span><p class="line874">Add to and remove from "Play 
Queue".  Both take 1 argument, the songs URI. <span class="anchor" 
id="line-325"></span><span class="anchor" id="line-326"></span></p><p 
class="line867"><span class="anchor" id="line-327"></span><span 
class="anchor" id="line-328"></span><span class="anchor" id="line-329"></span></p><pre>shell.add_to_queue("file://awsome_song.ogg")
shell.remove_from_queue("file://awsome_song.ogg")</pre><span 
class="anchor" id="line-330"></span><p class="line867">
</p><h2 id="head-5cced536c3b5ca72946e5b0c3a496c7d1f686d4b">Adding a new 
tab to the "Song Info" window</h2>
<span class="anchor" id="line-331"></span><p class="line874">The shell 
emits a signal whenever a song info window has been constructed, to 
allow plugins to add new things to it (such as the lyrics tab). To use 
it, do something like the following in your activate method <span 
class="anchor" id="line-332"></span><span class="anchor" id="line-333"></span></p><p
 class="line867"><span class="anchor" id="line-334"></span><span 
class="anchor" id="line-335"></span></p><pre>self.csi_id = shell.connect('create_song_info', self.create_song_info)</pre><span
 class="anchor" id="line-336"></span><p class="line874">the following in
 your deactivate method <span class="anchor" id="line-337"></span><span 
class="anchor" id="line-338"></span></p><p class="line867"><span 
class="anchor" id="line-339"></span><span class="anchor" id="line-340"></span><span
 class="anchor" id="line-341"></span></p><pre>shell.disconnect (self.csi_id)
del self.csi_id</pre><span class="anchor" id="line-342"></span><p 
class="line874">and define the create_song_info method <span 
class="anchor" id="line-343"></span><span class="anchor" id="line-344"></span></p><p
 class="line867"><span class="anchor" id="line-345"></span><span 
class="anchor" id="line-346"></span><span class="anchor" id="line-347"></span><span
 class="anchor" id="line-348"></span><span class="anchor" id="line-349"></span></p><pre>def create_song_info (self, shell, song_info, is_multiple):
    if is_multiple is False:
        pane = MyWidget(song_info.props.current_entry)
        song_info.append_page(_("My Tab"), pane)</pre><span 
class="anchor" id="line-350"></span><p class="line874">is_multiple will 
be True if the song-info window is for multiple entries, and false if 
it's for just one. If you're adding something to the single-entry 
version, you'll want to connect to the "notify::current-entry" signal, 
to update when the user uses the back and forwards buttons. <span 
class="anchor" id="line-351"></span>For multiple-entry song-info 
windows, use song_info.props.entry_view.get_selected_entries() to get 
the list of entries to process. <span class="anchor" id="line-352"></span><span
 class="anchor" id="line-353"></span></p><p class="line867">
</p><h2 id="head-49fe09e8941347300be7f76fd28ec163b2e86441">Perform 
actions when a source is first clicked on</h2>
<span class="anchor" id="line-354"></span><p class="line874">There are 
many circumstances when you may want to do some work when your source is
 first clicked on, rather than when the plugin loads, usually when they 
involve connection to remote machines. Examples include downloading the 
catalogue from an online store and connection to DAAP shares. <span 
class="anchor" id="line-355"></span><span class="anchor" id="line-356"></span></p><p
 class="line874">rb.Source has a virtual function called "impl_activate"
 which lets you implement this; the function is called whenever the 
source is "activated" (i.e. clicked on). To do something when the source
 is first activated (and not every time), add something like the 
following to your source's class <span class="anchor" id="line-357"></span><span
 class="anchor" id="line-358"></span></p><p class="line867"><span 
class="anchor" id="line-359"></span><span class="anchor" id="line-360"></span><span
 class="anchor" id="line-361"></span><span class="anchor" id="line-362"></span><span
 class="anchor" id="line-363"></span><span class="anchor" id="line-364"></span></p><pre>def do_impl_activate (self):
    if not self.activated:
        self.activated = True
        # do your stuff here
    rb.BrowserSource.do_impl_activate (self)</pre><span class="anchor" 
id="line-365"></span><p class="line867">
</p><h1 id="head-c43db38ba00af0f1493d54b97c70878f211a5814">Doing things 
the right way</h1>
<span class="anchor" id="line-366"></span><p class="line874">There are 
some things that many usually do when programming which can either suck 
or cause problems, some of which are specific to Rhythmbox and some of 
which aren't. This includes doing synchronous IO, using threads when you
 don't need to, and the like. This section describes some of these, and 
how to do them in a better way. <span class="anchor" id="line-367"></span><span
 class="anchor" id="line-368"></span></p><p class="line867">
</p><h2 id="head-a6becdd791a612695c0e00ecb8257cb1ab3d0e24">Using threads
 when you don't need to</h2>
<span class="anchor" id="line-369"></span><p class="line874">There are 
many valid uses for threads in programming, but many people use them 
when they don't need to and there is a perfectly good way of doing their
 task without threads - usually because they don't know about the other 
way. The main reason is that they don't want to block the UI while they 
perform a long task, with the usual candidate being some IO (especially 
network IO) or performing a long computation. Those two cases can 
usually be done without threads, and the associated things like locking,
 watching out for race conditions and the headaches that they can 
introduce. If you want to do IO, use asynchronous IO instead of a 
thread, and if you have a long computation which is actually a small 
computation done many times, you can do it in an idle callback. <span 
class="anchor" id="line-370"></span><span class="anchor" id="line-371"></span></p><p
 class="line867">
</p><h2 id="head-bfc9032902eebc86a4b92000c22510260534f1f2">Using 
asynchronous IO</h2>
<span class="anchor" id="line-372"></span><p class="line874">Synchronous
 IO, that is using functions which load data from somewhere and then 
return it, are bad because if it takes a non-trivial amount of time it 
will block the user interface and make Rhythmbox appear to lock up. 
Getting data over the network is the obvious example of this, but it it 
also happens with local file IO to, because it might be sitting on a NFS
 share, the hard disc could be busy with copying data, or a number of 
other things. So you should never use synchronous IO. <span 
class="anchor" id="line-373"></span><span class="anchor" id="line-374"></span></p><p
 class="line862">Now that I've convinced you to use asynchronous IO, the
 question is how to do it. If you're writing a C plugin, use GnomeVFS, 
whose docs are at <a class="http" 
href="http://developer.gnome.org/doc/API/2.0/gnome-vfs-2.0/gnome-vfs-20-gnome-vfs-async-ops.html">http://developer.gnome.org/doc/API/2.0/gnome-vfs-2.0/gnome-vfs-20-gnome-vfs-async-ops.html</a>.
 If you're writing a Python plugin, you can use GnomeVFS as well or for 
simple things use a convenience class that Rhythmbox has. <span 
class="anchor" id="line-375"></span><span class="anchor" id="line-376"></span></p><p
 class="line862">The python convenience class can be used whenever you 
want to load data asynchronously, but using GnomeVFS directly may be 
better in some situations, such as when you process the data as it 
arrives (see the next section for that). If you need all the data at 
once, the convenience class is for you. Using it is simply a matter of 
defining a <em>callback</em> function which uses the data and then 
adding a call to start the retrieval. <span class="anchor" id="line-377"></span><span
 class="anchor" id="line-378"></span></p><p class="line867"><span 
class="anchor" id="line-379"></span><span class="anchor" id="line-380"></span><span
 class="anchor" id="line-381"></span><span class="anchor" id="line-382"></span><span
 class="anchor" id="line-383"></span></p><pre>def mycallback(self, data):
        print data
loader = rb.Loader()
loader.get_url("http://www.rhythmbox.org/", self.mycallback)</pre><span 
class="anchor" id="line-384"></span><p class="line874">The above code 
retrieves the main Rhythmbox website, and prints it out. One things to 
note is that you can pass extra parameters to rb.Loader.get_url(), which
 are passed to your callback. If you have pygnomevfs installed the 
get_url() method will return immediately and mycallback() will be run 
when the data is available, if you don't have it installed it will 
fallback on using urllib and get_url() will block until after the data 
is retrieved and the callback run. <span class="anchor" id="line-385"></span><span
 class="anchor" id="line-386"></span></p><p class="line867">
</p><h2 id="head-4359a4580532110db4a49c7c85af93574d5051f9">Streaming IO</h2>
<span class="anchor" id="line-387"></span><p class="line874">TODO <span 
class="anchor" id="line-388"></span><span class="anchor" id="line-389"></span></p><p
 class="line867">
</p><h2 id="head-5aa93657b105402333622301cf1fd0c57b133cb5">Using idle 
callbacks for repeated tasks</h2>
<span class="anchor" id="line-390"></span><p class="line874">Many times 
when some code has to perform a long computation or task, it is actually
 a small task which is repeated many times. For example loading the 
track database from an iPod isn't one long task, it's the process of 
loading one track from the iPod DB repeated over and over. This kind of 
task can be reworked to use Glib's "idle callback" mechanism, which 
allows you do the work without blocking the user interface and without a
 thread. <span class="anchor" id="line-391"></span><span class="anchor" 
id="line-392"></span></p><p class="line874">Conceptually, the long task 
looks like this: <span class="anchor" id="line-393"></span><span 
class="anchor" id="line-394"></span></p><p class="line867"><span 
class="anchor" id="line-395"></span><span class="anchor" id="line-396"></span><span
 class="anchor" id="line-397"></span><span class="anchor" id="line-398"></span><span
 class="anchor" id="line-399"></span><span class="anchor" id="line-400"></span></p><pre>finished = False
initialise()
while not finished:
        finished = do_piece_of_work()
cleanup()</pre><span class="anchor" id="line-401"></span><p 
class="line874">which can be transformed into: <span class="anchor" 
id="line-402"></span><span class="anchor" id="line-403"></span></p><p 
class="line867"><span class="anchor" id="line-404"></span><span 
class="anchor" id="line-405"></span><span class="anchor" id="line-406"></span><span
 class="anchor" id="line-407"></span><span class="anchor" id="line-408"></span><span
 class="anchor" id="line-409"></span><span class="anchor" id="line-410"></span><span
 class="anchor" id="line-411"></span><span class="anchor" id="line-412"></span><span
 class="anchor" id="line-413"></span><span class="anchor" id="line-414"></span><span
 class="anchor" id="line-415"></span></p><pre>def idle_cb(self):
        gtk.gdk.threads_enter()
        finished = do_piece_of_work()
        if not finished:
                gtk.gdk.threads_leave()
                return True
        cleanup()
        gtk.gdk.threads_leave()
        return False
initialise()
gobject.idle_add(self.idle_cb)</pre><span class="anchor" id="line-416"></span><p
 class="line862">If your code looks somewhat like the first one, it 
should be fairly easy to re-write in the second form. Once you've done 
this, your plugin will be much nicer as it doesn't block the UI while 
doing the task. One thing to note is the gtk.gdk.threads_enter() and 
gtk.gdk.threads_leave() calls. These are <strong>required</strong> if 
there is any chance that any GTK code will be run, and since you could 
do something whch causes a signal to be emitted, and anything could have
 a callback registered on the signal, you should really do it. Trust me.
 <span class="anchor" id="line-417"></span><span class="anchor" 
id="line-418"></span></p><p class="line867">
</p><h3 id="head-bc65591f65a60fce5fd4d6f2bbf7e6a88d6bdf54">Chunking idle
 callbacks</h3>
<span class="anchor" id="line-419"></span><p class="line874">If the 
small piece of work you're doing is actually fairly small, and repeated a
 large number of times, the above method can reduce performance a fair 
bit due to the overhead of running the idle callback that many times. 
The solution to this is to do more work in each callback; rather than 
calling do_piece_of_work() once, call it a greater number of times, i.e.
 <span class="anchor" id="line-420"></span><span class="anchor" 
id="line-421"></span></p><p class="line867"><span class="anchor" 
id="line-422"></span><span class="anchor" id="line-423"></span><span 
class="anchor" id="line-424"></span><span class="anchor" id="line-425"></span><span
 class="anchor" id="line-426"></span><span class="anchor" id="line-427"></span><span
 class="anchor" id="line-428"></span><span class="anchor" id="line-429"></span><span
 class="anchor" id="line-430"></span><span class="anchor" id="line-431"></span><span
 class="anchor" id="line-432"></span><span class="anchor" id="line-433"></span><span
 class="anchor" id="line-434"></span><span class="anchor" id="line-435"></span><span
 class="anchor" id="line-436"></span><span class="anchor" id="line-437"></span></p><pre>def idle_cb(self):
        gtk.gdk.threads_enter()
        finished = False
        count = 0
        while not finished and count &lt; SOME_NUMBER:
                finished = do_piece_of_work()
                count++
        if not finished:
                gtk.gdk.threads_leave()
                return True
        cleanup()
        gtk.gdk.threads_leave()
        return False
initialise()
gobject.idle_add(self.idle_cb)</pre><span class="anchor" id="line-438"></span><p
 class="line874">The choice of SOME_NUMBER is fairly important, but 
could be completely different depending on what you're doing - it might 
be 10, 100, 1000 or something else. Larger numbers will give you better 
performance but will block the UI for longer, a happy value will give a 
bit of a performance increase over 1 (what the non-chunking version is 
equivalent to) but not take too long even with older/busy computers. <span
 class="anchor" id="line-439"></span><span class="anchor" id="line-440"></span></p><p
 class="line867">
</p><h1 id="head-7a185be2a26176c61db014d8eeb8c980c95fbf15">Doing Cool 
Things(tm)</h1>
<span class="anchor" id="line-441"></span><p class="line867">
</p><h2 id="head-7cd42591b00fdab44374fd57538003a192960070">Adding 
elements to the GStreamer playback pipeline</h2>
<span class="anchor" id="line-442"></span><p class="line874">In SVN 
plugins can add elements to the GStreamer pipeline, to do interesting 
things with the audio. You can add "filtering" elements, which alter the
 audio the user hears (such as for and equalizer, or other special 
effects) and "tee" elements which get a copy of the audio (e.g. to send 
across the network, to another application, or convert to a different 
format). <span class="anchor" id="line-443"></span><span class="anchor" 
id="line-444"></span></p><p class="line874">In either case, what you 
need to do is create a GStreamer element, and then ask the playback 
backend to insert it. Later, either when it is finished or your plugin 
is being deactived, you need to ask the playback backend to remove it. 
Inserted elements will transparently be moved to the correct place if 
the pipeline changes. If you need multiple elements to do what you want,
 put them in a Bin and add that. <span class="anchor" id="line-445"></span><span
 class="anchor" id="line-446"></span></p><p class="line874">You should 
check that the playback backend implements the functionality before 
trying to use it, since not all backends may implement all the different
 types of elements. In C, you should check the object implements the 
appropriate GObject interface, an in Python you should check the methods
 exist. <span class="anchor" id="line-447"></span><span class="anchor" 
id="line-448"></span></p><p class="line874">As an example, here is how 
you add a "poor mans's visualisation" using Python (it can be run in the
 python console). <span class="anchor" id="line-449"></span><span 
class="anchor" id="line-450"></span></p><p class="line867"><span 
class="anchor" id="line-451"></span><span class="anchor" id="line-452"></span><span
 class="anchor" id="line-453"></span><span class="anchor" id="line-454"></span><span
 class="anchor" id="line-455"></span><span class="anchor" id="line-456"></span><span
 class="anchor" id="line-457"></span><span class="anchor" id="line-458"></span><span
 class="anchor" id="line-459"></span><span class="anchor" id="line-460"></span><span
 class="anchor" id="line-461"></span></p><pre>import gst
goom = gst.element_factory_make ("goom")
sink = gst.element_factory_make ("ximagesink")
colour = gst.element_factory_make ("ffmpegcolorspace")
b = gst.Bin()
b.add (goom, colour, sink)
b.add_pad(gst.GhostPad("sink", goom.get_pad("sink")))
goom.link(colour)
colour.link(sink)
shell.get_player().props.player.add_tee(b)</pre><span class="anchor" 
id="line-462"></span><p class="line874">and remove it <span 
class="anchor" id="line-463"></span><span class="anchor" id="line-464"></span></p><p
 class="line867"><span class="anchor" id="line-465"></span><span 
class="anchor" id="line-466"></span></p><pre>shell.get_player().props.player.remove_tee(b)</pre><span
 class="anchor" id="line-467"></span><p class="line867">
</p><h1 id="head-52167e5ed4a8acd0c087de2633e890dab5d871da">How do I ...</h1>
<span class="anchor" id="line-468"></span><p class="line867">
</p><h2 id="head-7fd5985806ac73cff392fa77027e2432f24bd4da">Get the list 
of entries in a source?</h2>
<span class="anchor" id="line-469"></span><p class="line862">Sources 
have a "query-model" property, which lets you access the rhythmdb.<a 
class="nonexistent" href="http://live.gnome.org/QueryModel">QueryModel</a>
 (which is a gtk.<a class="nonexistent" 
href="http://live.gnome.org/TreeModel">TreeModel</a>) which backs the 
track list. You can simply iterate over the rows in the model, getting 
each of the entries in turn (a reference is stored in the zeroeth 
column). For example <span class="anchor" id="line-470"></span><span 
class="anchor" id="line-471"></span></p><p class="line867"><span 
class="anchor" id="line-472"></span><span class="anchor" id="line-473"></span><span
 class="anchor" id="line-474"></span><span class="anchor" id="line-475"></span></p><pre>for row in mysource.props.query_model:
        entry = row[0]
        print db.entry_get(entry, rhythmdb.PROP_TITLE)</pre><span 
class="anchor" id="line-476"></span><p class="line867">
</p><h2 id="head-dbb2fdf06779fa9211dd014279f1ff57690db652">Disable a bad
 plugin from outside Rhythmbox?</h2>
<span class="anchor" id="line-477"></span><p class="line874">If you've 
written a plugin that crashes Rhythmbox, instead of moving the plugin to
 a different directory you can disable it in the gconf. <span 
class="anchor" id="line-478"></span>For eg, open up "gconf-editor" and 
navigate to apps-&gt;rhythmbox-&gt;plugins-&gt;[plugin name] and untick 
"active". <span class="anchor" id="line-479"></span>I find that when I 
activate a bad plugin from inside Rhythmbox, it provides more usefull 
output then if you have started Rhythmbox with the plugin activated. <span
 class="anchor" id="line-480"></span>
</p><h1 id="head-dd038444a38370785adc408c52c53fb9edf95bd7">Things to 
check before checking into SVN</h1>
<span class="anchor" id="line-481"></span><ul><li>plugin installs to 
$prefix/lib/rhythmbox/plugins/$plugin/ <span class="anchor" 
id="line-482"></span></li><li>all necessary files are installed (don't 
just run uninstalled) <span class="anchor" id="line-483"></span></li><li>works
 correctly across enable/disable cycles <span class="anchor" 
id="line-484"></span></li><li>/apps/rhythmbox/plugins/$plugin/active and
 /apps/rhythmbox/plugins/$plugins/hidden added to rhythmbox.schemas <span
 class="anchor" id="line-485"></span></li><li>any plugin-specific UI is 
split out to a separate file in the plugin directory <span 
class="anchor" id="line-486"></span></li><li>.cvsignore file in the 
plugin source directory <span class="anchor" id="line-487"></span></li><li>copyright/license
 headers for all files (with a compatible license..) <span 
class="anchor" id="line-488"></span><span class="anchor" id="line-489"></span><span
 class="anchor" id="line-490"></span></li></ul><p class="line862">See 
also <a 
href="http://live.gnome.org/Rhythmbox%20Plugins/Python%20Plugin%20Examples">Rhythmbox
 Plugins/Python Plugin Examples</a> <span class="anchor" id="line-491"></span><span
 class="anchor" id="bottom"></span></p></div><p id="pageinfo" 
class="info" dir="ltr" lang="en">RhythmboxPlugins/WritingGuide  (last 
edited 2009-10-20 13:41:52 by <span title="MattKraai @ 
pool-173-51-225-123.lsanca.fios.verizon.net[173.51.225.123]"><a 
class="nonexistent" href="http://live.gnome.org/MattKraai" 
title="MattKraai @ 
pool-173-51-225-123.lsanca.fios.verizon.net[173.51.225.123]">MattKraai</a></span>)</p>

<div id="pagebottom"></div>
</div>


<div id="sidebar">
<div class="section">
<h3>User</h3>
<ul id="username"><li><a 
href="http://live.gnome.org/action/login/RhythmboxPlugins/WritingGuide?action=login"
 id="login" rel="nofollow">Login</a></li></ul>
</div>
<div class="section">
<h3>Page</h3>
<ul class="editbar"><li><span class="disabled">Immutable Page</span></li><li><a
 href="#" class="toggleCommentsButton" style="display: none;" 
onclick="toggleComments();return false;">Comments</a></li><li><a 
class="nbinfo" 
href="http://live.gnome.org/action/info/RhythmboxPlugins/WritingGuide?action=info"
 rel="nofollow">Info</a></li><li><a class="nbattachments" 
href="http://live.gnome.org/action/AttachFile/RhythmboxPlugins/WritingGuide?action=AttachFile"
 rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="get" 
action="/RhythmboxPlugins/WritingGuide">
<div>
    
    <select name="action" onchange="if ((this.selectedIndex != 0) 
&amp;&amp;
                      (this.options[this.selectedIndex].disabled == 
false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option selected="selected" value="show">More Actions:</option><option
 value="raw">Raw Text</option>
<option value="print">Print View</option>
<option value="RenderAsDocbook">Render as Docbook</option>
<option value="refresh">Delete Cache</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="SpellCheck">Check Spelling</option>
<option value="LikePages">Like Pages</option>
<option value="LocalSiteMap">Local Site Map</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="RenamePage" disabled="disabled" class="disabled">Rename 
Page</option>
<option value="CopyPage" disabled="disabled" class="disabled">Copy Page</option>
<option value="DeletePage" disabled="disabled" class="disabled">Delete 
Page</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="MyPages" disabled="disabled" class="disabled">My Pages</option>
<option value="SubscribeUser">Subscribe User</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="Despam">Remove Spam</option>
<option value="revert">Revert to this revision</option>
<option value="PackagePages">Package Pages</option>
<option value="SyncPages">Sync Pages</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="Load">Load</option>
<option value="Save">Save</option>
    </select>
    
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

</div>
<div class="section">
<h3>GNOME World Wide</h3>
<a href="http://live.gnome.org/GnomeWorldWide"><img 
src="WritingGuide_files/GnomeWorldWideSmall.jpg" alt=""></a>
</div>
</div>

  <div id="footer">
    Copyright © 2005, 2006, 2007 <a href="http://www.gnome.org/">The 
GNOME Project</a>.<br>
    Hosted by <a href="http://www.redhat.com/">Red Hat</a>.
  </div><div style="display: none;" id="feedlySignPart"></div></body></html>